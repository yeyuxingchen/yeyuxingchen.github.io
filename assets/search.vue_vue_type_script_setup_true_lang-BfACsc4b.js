
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{_ as le}from"./index.vue_vue_type_script_setup_true_lang-BTziXNrW.js";import{_ as ae}from"./index.vue_vue_type_script_setup_true_lang-Des25nH4.js";import{d as ne,F as oe,a2 as re,bo as ue,a9 as ie,p as F,aP as L,bp as ce,b as fe,q as O,v as de,ax as v,x as pe,bq as q,e as S,o as f,g as d,w as h,H as o,G as k,a0 as j,a1 as G,X as J,f as M,Y as ve,L as X,S as Y,k as p,K as me,aO as he,h as I,i as C,N as xe,a4 as _e}from"./index-DEvcBNPV.js";import ge from"./index-9nDyShVP.js";import{_ as ye}from"./item.vue_vue_type_script_setup_true_lang-Zt4_WTIy.js";const ke={class:"h-12 flex flex-shrink-0 items-center"},be={class:"h-full w-14 flex-center"},Re=["onKeydown"],we={key:0,class:"h-full w-14 flex-center border-s"},Se={class:"w-full flex justify-between px-4 py-3"},Me={class:"flex gap-8"},Ie={class:"inline-flex items-center gap-1 text-xs"},Ce={class:"inline-flex items-center gap-1 text-xs"},Ve={key:0,class:"inline-flex items-center gap-1 text-xs"},Te=["data-index","onClick","onMouseover"],ze={class:"flex flex-1 flex-col gap-1 truncate border-s px-4 py-3"},Be={class:"truncate text-start text-base font-bold"},Ne={key:1,class:"h-full flex-col-center py-6 text-secondary-foreground/50"},$e={key:2,class:"h-full flex-col-center py-6 text-secondary-foreground/50"},Ke=ne({name:"NavSearchModal",__name:"search",props:{modelValue:{type:Boolean,default:!1},modelModifiers:{}},emits:["update:modelValue"],setup(A){const x=oe(A,"modelValue"),Q=_e(),b=re(),V=ue(),W=ie(),c=F(""),D=L("searchInputRef"),{focused:Z}=ce(D),T=F([]),n=F(-1),z=L("searchResultRef"),w=L("searchResultItemRef"),_=fe(()=>{let a=[];return a=T.value.filter(e=>{let s=!1;return c.value!==""&&(e.title&&(typeof e.title=="function"?e.title().includes(c.value)&&(s=!0):e.title.includes(c.value)&&(s=!0)),e.path.includes(c.value)&&(s=!0),V.getRouteMatchedByPath(e.path).some(l=>{var i,t,r,u;return typeof((i=l.meta)==null?void 0:i.title)=="function"?(t=l.meta)==null?void 0:t.title().includes(c.value):(u=(r=l.meta)==null?void 0:r.title)==null?void 0:u.includes(c.value)})&&(s=!0)),s}),a});O(()=>x.value,a=>{a?(c.value="",n.value=-1,v("up",B),v("down",N),v("enter",$),v("esc",e=>{b.settings.navSearch.enableHotkeys&&(e.preventDefault(),x.value=!1)})):(v.unbind("up",B),v.unbind("down",N),v.unbind("enter",$),v.unbind("esc"))}),O(()=>_.value,()=>{n.value=-1,H()}),de(()=>{ee(),v("command+k, ctrl+k",a=>{b.settings.navSearch.enableHotkeys&&(a.preventDefault(),x.value=!0)})}),pe(()=>{v.unbind("command+k, ctrl+k")});function ee(){T.value=[],W.allMenus.forEach(a=>{K(a.children)})}function te(a){var s;let e=!0;return(s=a.children)!=null&&s.every(l=>{var i;return((i=l.meta)==null?void 0:i.menu)===!1})&&(e=!1),e}function K(a,e,s){a.forEach(l=>{var i,t,r,u,m;((i=l.meta)==null?void 0:i.menu)!==!1&&(l.children&&te(l)?K(l.children,q(e,l.path),((t=l.meta)==null?void 0:t.icon)??s):T.value.push({path:q(e,l.path),icon:((r=l.meta)==null?void 0:r.icon)??s,title:(u=l.meta)==null?void 0:u.title,link:(m=l.meta)==null?void 0:m.link}))})}function B(){_.value.length&&(n.value-=1,n.value<0&&(n.value=_.value.length-1),H())}function N(){_.value.length&&(n.value+=1,n.value>_.value.length-1&&(n.value=0),H())}function $(){var a,e;n.value!==-1&&((e=(a=w.value)==null?void 0:a.find(s=>Number.parseInt(s.dataset.index)===n.value))==null||e.click())}function H(){var a,e,s,l,i,t,r,u;if((l=(s=(e=(a=z.value)==null?void 0:a.areaRef)==null?void 0:e.ref)==null?void 0:s.el)!=null&&l.viewportElement){const m=z.value.areaRef.ref.el.viewportElement;let g=0;if(n.value!==-1){g=m.scrollTop;const y=((t=(i=w.value)==null?void 0:i.find(E=>Number.parseInt(E.dataset.index)===n.value))==null?void 0:t.offsetTop)??0,R=((u=(r=w.value)==null?void 0:r.find(E=>Number.parseInt(E.dataset.index)===n.value))==null?void 0:u.clientHeight)??0,U=m.scrollTop,P=m.clientHeight;y+R>U+P?g=y+R-P:y<=U&&(g=y-16)}m.scrollTo({top:g})}}function se(a,e){e?window.open(e,"_blank"):Q.push(a),x.value=!1}return(a,e)=>{const s=ve,l=ae,i=le;return f(),S(i,{ref_key:"searchResultRef",ref:z,modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=t=>x.value=t),border:"",footer:d(b).mode==="pc",closable:!1,class:"w-full lg-max-w-2xl","content-class":"flex flex-col p-0 min-h-auto","header-class":"p-0","footer-class":"p-0",onOpened:e[4]||(e[4]=t=>Z.value=!0)},{header:h(()=>[o("div",ke,[o("div",be,[p(s,{name:"i-ri:search-line",class:"size-4 text-foreground/30"})]),me(o("input",{ref_key:"searchInputRef",ref:D,"onUpdate:modelValue":e[0]||(e[0]=t=>xe(c)?c.value=t:null),placeholder:"搜索页面，支持标题、URL模糊查询",class:"h-full w-full border-0 rounded-md bg-transparent text-base text-foreground focus-outline-none placeholder-foreground/30",onKeydown:[e[1]||(e[1]=I(C(t=>x.value=!1,["prevent"]),["esc"])),I(C(B,["prevent"]),["up"]),I(C(N,["prevent"]),["down"]),I(C($,["prevent"]),["enter"])]},null,40,Re),[[he,d(c)]]),d(b).mode==="mobile"?(f(),k("div",we,[p(s,{name:"i-carbon:close",class:"size-4",onClick:e[2]||(e[2]=t=>x.value=!1)})])):M("",!0)])]),footer:h(()=>[o("div",Se,[o("div",Me,[o("div",Ie,[p(l,null,{default:h(()=>[p(s,{name:"i-ion:md-return-left",class:"size-4"})]),_:1}),e[5]||(e[5]=o("span",null,"访问",-1))]),o("div",Ce,[p(l,null,{default:h(()=>[p(s,{name:"i-ant-design:caret-up-filled",class:"size-4"})]),_:1}),p(l,null,{default:h(()=>[p(s,{name:"i-ant-design:caret-down-filled",class:"size-4"})]),_:1}),e[6]||(e[6]=o("span",null,"切换",-1))])]),d(b).settings.navSearch.enableHotkeys?(f(),k("div",Ve,[p(l,null,{default:h(()=>e[7]||(e[7]=[Y(" ESC ")])),_:1,__:[7]}),e[8]||(e[8]=o("span",null,"退出",-1))])):M("",!0)])]),default:h(()=>[o("div",null,[d(_).length>0?(f(!0),k(j,{key:0},G(d(_),(t,r)=>(f(),k("div",{ref_for:!0,ref_key:"searchResultItemRef",ref:w,key:t.path,class:"p-4","data-index":r,onClick:u=>se(t.path,t.link),onMouseover:u=>n.value=r},[o("a",{class:J(["flex cursor-pointer items-center border rounded-lg",{"-mt-4":r!==0,"bg-accent":r===d(n)}])},[t.icon?(f(),S(s,{key:0,name:t.icon,class:J(["size-5 basis-16 transition",{"scale-120 text-primary":r===d(n)}])},null,8,["name","class"])):M("",!0),o("div",ze,[o("div",Be,X((typeof t.title=="function"?t.title():t.title)??"[ 无标题 ]"),1),d(V).getRouteMatchedByPath(t.path).length?(f(),S(ge,{key:0,class:"truncate"},{default:h(()=>[(f(!0),k(j,null,G(d(V).getRouteMatchedByPath(t.path),(u,m)=>(f(),S(ye,{key:m,class:"text-xs"},{default:h(()=>{var g,y,R;return[Y(X((typeof((g=u.meta)==null?void 0:g.title)=="function"?(y=u.meta)==null?void 0:y.title():(R=u.meta)==null?void 0:R.title)??"[ 无标题 ]"),1)]}),_:2},1024))),128))]),_:2},1024)):M("",!0)])],2)],40,Te))),128)):d(c)===""?(f(),k("div",Ne,[p(s,{name:"i-tabler:mood-smile",class:"size-10"}),e[9]||(e[9]=o("p",{class:"m-2 text-base"}," 输入你要搜索的导航 ",-1))])):(f(),k("div",$e,[p(s,{name:"i-tabler:mood-empty",class:"size-10"}),e[10]||(e[10]=o("p",{class:"m-2 text-base"}," 没有找到你想要的 ",-1))]))])]),_:1},8,["modelValue","footer"])}}});export{Ke as _};
