
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{_ as G}from"./index.vue_vue_type_script_setup_true_lang-BTziXNrW.js";import{d as v,u as R,c as H,p as h,e as g,o as f,w as n,r as w,g as e,P as E,az as M,f as k,aA as T,b as J,v as K,x as Q,t as W,q as X,K as Y,O as Z,X as b,D as z,Q as ee,R as se,m as S,aB as ae,k as t,S as I,L as x,J as j,as as te,G as y,H as p,T as C,U as N,a0 as D,a1 as oe,a2 as ne,aC as le,a4 as re,Y as ce,N as ie}from"./index-DEvcBNPV.js";import{e as de}from"./eventBus-CGRXT3Tn.js";import{_ as ue}from"./index-BunjYBV2.js";import{u as pe,t as fe,o as me,s as F,F as P,_ as A,a as B,c as L}from"./FormMessage.vue_vue_type_script_setup_true_lang-DTts0P05.js";const[U,_e]=H("AvatarRoot"),ve=v({__name:"AvatarRoot",props:{asChild:{type:Boolean},as:{default:"span"}},setup(l){return R(),_e({imageLoadingStatus:h("idle")}),(s,a)=>(f(),g(e(E),{"as-child":s.asChild,as:s.as},{default:n(()=>[w(s.$slots,"default")]),_:3},8,["as-child","as"]))}}),he=v({__name:"AvatarFallback",props:{delayMs:{},asChild:{type:Boolean},as:{default:"span"}},setup(l){const s=l,a=U();R();const i=h(s.delayMs===void 0);return M(r=>{if(s.delayMs&&T){const d=window.setTimeout(()=>{i.value=!0},s.delayMs);r(()=>{window.clearTimeout(d)})}}),(r,d)=>i.value&&e(a).imageLoadingStatus.value!=="loaded"?(f(),g(e(E),{key:0,"as-child":r.asChild,as:r.as},{default:n(()=>[w(r.$slots,"default")]),_:3},8,["as-child","as"])):k("",!0)}});function V(l,s){return l?s?(l.src!==s&&(l.src=s),l.complete&&l.naturalWidth>0?"loaded":"loading"):"error":"idle"}function ge(l,{referrerPolicy:s,crossOrigin:a}={}){const i=h(!1),r=h(null),d=J(()=>i.value?(!r.value&&T&&(r.value=new window.Image),r.value):null),c=h(V(d.value,l.value)),u=m=>()=>{i.value&&(c.value=m)};return K(()=>{i.value=!0,M(m=>{const o=d.value;if(!o)return;c.value=V(o,l.value);const _=u("loaded"),$=u("error");o.addEventListener("load",_),o.addEventListener("error",$),s!=null&&s.value&&(o.referrerPolicy=s.value),typeof(a==null?void 0:a.value)=="string"&&(o.crossOrigin=a.value),m(()=>{o.removeEventListener("load",_),o.removeEventListener("error",$)})})}),Q(()=>{i.value=!1}),c}const ye=v({__name:"AvatarImage",props:{src:{},referrerPolicy:{},crossOrigin:{},asChild:{type:Boolean},as:{default:"img"}},emits:["loadingStatusChange"],setup(l,{emit:s}){const a=l,i=s,{src:r,referrerPolicy:d,crossOrigin:c}=W(a);R();const u=U(),m=ge(r,{referrerPolicy:d,crossOrigin:c});return X(m,o=>{i("loadingStatusChange",o),o!=="idle"&&(u.imageLoadingStatus.value=o)},{immediate:!0}),(o,_)=>Y((f(),g(e(E),{role:"img","as-child":o.asChild,as:o.as,src:e(r),"referrer-policy":e(d)},{default:n(()=>[w(o.$slots,"default")]),_:3},8,["as-child","as","src","referrer-policy"])),[[Z,e(m)==="loaded"]])}}),we=v({__name:"Avatar",props:{class:{},size:{default:"sm"},shape:{default:"circle"}},setup(l){const s=l;return(a,i)=>(f(),g(e(ve),{class:b(e(z)(e($e)({size:a.size,shape:a.shape}),s.class))},{default:n(()=>[w(a.$slots,"default")]),_:3},8,["class"]))}}),be=v({__name:"AvatarFallback",props:{delayMs:{},asChild:{type:Boolean},as:{type:[String,Object,Function]}},setup(l){const s=l;return(a,i)=>(f(),g(e(he),ee(se(s)),{default:n(()=>[w(a.$slots,"default")]),_:3},16))}}),xe=v({__name:"AvatarImage",props:{src:{},referrerPolicy:{},crossOrigin:{},asChild:{type:Boolean},as:{type:[String,Object,Function]}},setup(l){const s=l;return(a,i)=>(f(),g(e(ye),S(s,{class:"h-full w-full object-cover"}),{default:n(()=>[w(a.$slots,"default")]),_:3},16))}}),$e=ae("inline-flex items-center justify-center font-normal text-foreground select-none shrink-0 bg-secondary overflow-hidden",{variants:{size:{sm:"h-10 w-10 text-xs",base:"h-16 w-16 text-2xl",lg:"h-32 w-32 text-5xl"},shape:{circle:"rounded-full",square:"rounded-md"}}}),Se=v({name:"FaAvatar",__name:"index",props:{src:{},fallback:{},shape:{},class:{}},setup(l){const s=l;return(a,i)=>(f(),g(e(we),{shape:a.shape,class:b(s.class)},{default:n(()=>[t(e(xe),{src:a.src},null,8,["src"]),t(e(be),{class:"inline-flex"},{default:n(()=>[w(a.$slots,"default",{},()=>[I(x(a.fallback),1)])]),_:3})]),_:3},8,["shape","class"]))}}),ke={class:"w-full flex-col-stretch-center"},Ce=v({name:"EditPasswordForm",__name:"EditPasswordForm",setup(l){const s=j(),a=h(!1),r=pe({validationSchema:fe(me({password:F().min(1,"请输入原密码"),newPassword:F().min(1,"请输入新密码").min(6,"密码长度为6到18位").max(18,"密码长度为6到18位"),checkPassword:F().min(1,"请确认新密码")}).refine(d=>d.newPassword===d.checkPassword,{message:"两次输入的密码不一致",path:["checkPassword"]})),initialValues:{password:"",newPassword:"",checkPassword:""}}).handleSubmit(d=>{a.value=!0,s.editPassword(d).then(async()=>{te.success("模拟修改成功，请重新登录"),s.logout()}).finally(()=>{a.value=!1})});return(d,c)=>{const u=ue,m=N;return f(),y("div",ke,[c[2]||(c[2]=p("div",{class:"mb-6 space-y-2"},[p("h3",{class:"text-4xl color-[var(--el-text-color-primary)] font-bold"}," 修改密码 "),p("p",{class:"text-sm text-muted-foreground lg:text-base"}," 请输入原密码、新密码和确认密码 ")],-1)),p("form",{onSubmit:c[0]||(c[0]=(...o)=>e(r)&&e(r)(...o))},[t(e(P),{name:"password"},{default:n(({componentField:o,errors:_})=>[t(e(A),{class:"relative pb-6 space-y-0"},{default:n(()=>[t(e(B),null,{default:n(()=>[t(u,S({type:"password",placeholder:"请输入原密码",class:["w-full",_.length&&"border-destructive"]},o),null,16,["class"])]),_:2},1024),t(C,{"enter-active-class":"transition-opacity","enter-from-class":"opacity-0","leave-active-class":"transition-opacity","leave-to-class":"opacity-0"},{default:n(()=>[t(e(L),{class:"absolute bottom-1 text-xs"})]),_:1})]),_:2},1024)]),_:1}),t(e(P),{name:"newPassword"},{default:n(({componentField:o,errors:_})=>[t(e(A),{class:"relative pb-6 space-y-0"},{default:n(()=>[t(e(B),null,{default:n(()=>[t(u,S({type:"password",placeholder:"请输入新密码",class:["w-full",_.length&&"border-destructive"]},o),null,16,["class"])]),_:2},1024),t(C,{"enter-active-class":"transition-opacity","enter-from-class":"opacity-0","leave-active-class":"transition-opacity","leave-to-class":"opacity-0"},{default:n(()=>[t(e(L),{class:"absolute bottom-1 text-xs"})]),_:1})]),_:2},1024)]),_:1}),t(e(P),{name:"checkPassword"},{default:n(({componentField:o,errors:_})=>[t(e(A),{class:"relative pb-6 space-y-0"},{default:n(()=>[t(e(B),null,{default:n(()=>[t(u,S({type:"password",placeholder:"请确认新密码",class:["w-full",_.length&&"border-destructive"]},o),null,16,["class"])]),_:2},1024),t(C,{"enter-active-class":"transition-opacity","enter-from-class":"opacity-0","leave-active-class":"transition-opacity","leave-to-class":"opacity-0"},{default:n(()=>[t(e(L),{class:"absolute bottom-1 text-xs"})]),_:1})]),_:2},1024)]),_:1}),t(m,{loading:e(a),size:"lg",class:"mt-8 w-full",type:"submit"},{default:n(()=>c[1]||(c[1]=[I(" 保存 ")])),_:1,__:[1]},8,["loading"])],32)])}}}),Fe={class:"min-h-full w-full"},Pe={class:"fixed inset-s-0 bottom-0 top-0 h-full w-40 border-e"},Ae=["onClick"],Be={class:"text-base text-accent-foreground leading-tight"},Le={class:"text-xs text-accent-foreground/50"},ze={class:"ms-40 min-h-full flex-col-center p-10"},Re={key:0},Ee=v({__name:"profile",setup(l){const s=h(0),a=h([{title:"基本设置",description:"账号的基本信息，头像、昵称等"},{title:"安全设置",description:"定期修改密码可以提高帐号安全性"}]);return(i,r)=>(f(),y("div",Fe,[p("div",Pe,[(f(!0),y(D,null,oe(e(a),(d,c)=>(f(),y("div",{key:c,class:b(["cursor-pointer px-4 py-3 transition-background-color space-y-2 hover-bg-accent/50",{"bg-accent hover-bg-accent!":e(s)===c}]),onClick:u=>s.value=c},[p("div",Be,x(d.title),1),p("div",Le,x(d.description),1)],10,Ae))),128))]),p("div",ze,[e(s)===0?(f(),y("div",Re," 请开发者自行扩展 ")):k("",!0),e(s)===1?(f(),g(Ce,{key:1})):k("",!0)])]))}}),Ve={class:"space-y-2"},Me={class:"flex-center-start gap-2"},Te={class:"space-y-1"},Ie={class:"text-base lh-none"},je={key:0,class:"min-w-0 flex-center-between flex-1 gap-2"},Ne={class:"flex-1 truncate text-start"},He=v({__name:"index",props:{onlyAvatar:{type:Boolean},dropdownAlign:{default:"end"},dropdownSide:{default:"right"},buttonVariant:{default:"ghost"},class:{}},setup(l){const s=l,a=re(),i=ne(),r=j(),d=h(!1);return(c,u)=>{const m=Se,o=ce,_=N,$=le,q=G;return f(),y(D,null,[t($,{align:c.dropdownAlign,side:c.dropdownSide,items:[[{label:e(i).settings.home.title,icon:"i-mdi:home",handle:()=>e(a).push({path:e(i).settings.home.fullPath}),hide:!e(i).settings.home.enable},{label:"个人设置",icon:"i-mdi:account",handle:()=>d.value=!0}],[{label:"快捷键介绍",icon:"i-mdi:keyboard",handle:()=>e(de).emit("global-hotkeys-intro-toggle"),hide:e(i).mode!=="pc"}],[{label:"退出登录",icon:"i-mdi:logout",handle:()=>e(r).logout(e(i).settings.home.fullPath)}]],class:"flex-center"},{header:n(()=>[p("div",Ve,[u[2]||(u[2]=p("div",{class:"text-xs text-secondary-foreground/50 font-light"}," 当前登录账号 ",-1)),p("div",Me,[t(m,{src:e(r).avatar,fallback:e(r).account.slice(0,5),shape:"square"},null,8,["src","fallback"]),p("div",Te,[p("div",Ie,x(e(r).account),1),u[1]||(u[1]=p("div",{class:"text-xs text-secondary-foreground/50 font-normal"}," [ 这里可以显示邮箱 ] ",-1))])])])]),default:n(()=>[t(_,{variant:c.buttonVariant,class:b(e(z)("flex-center gap-1 p-2",{"size-8 p-1":c.onlyAvatar},s.class))},{default:n(()=>[t(m,{src:e(r).avatar,class:b(e(z)("size-6",{"size-full":c.onlyAvatar}))},{default:n(()=>[t(o,{name:"i-carbon:user-avatar-filled",class:"size-6 text-secondary-foreground/50"})]),_:1},8,["src","class"]),e(i).mode==="pc"&&!c.onlyAvatar?(f(),y("div",je,[p("div",Ne,x(e(r).account),1),t(o,{name:"i-material-symbols:expand-all-rounded"})])):k("",!0)]),_:1},8,["variant","class"])]),_:1},8,["align","side","items"]),t(q,{modelValue:e(d),"onUpdate:modelValue":u[0]||(u[0]=O=>ie(d)?d.value=O:null),"align-center":"",header:!1,footer:!1,"close-on-click-overlay":!1,"close-on-press-escape":!1,class:"h-500px min-w-600px overflow-hidden","content-class":"min-h-full p-0 flex"},{default:n(()=>[t(Ee)]),_:1},8,["modelValue"])],64)}}});export{He as _};
